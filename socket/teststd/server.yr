import core.io;
import socket;

def main()
{
    let sock = CreateSocket (AddrFamily::AfInet, SocketType::SockStream);

    if (sock.handle < 0)
    {
        println ("CreateSocket() error");
    }
    else
    {
        if (!sock.Bind (8888US))
        {
            println ("Bind() error");
        }
        else
        {
            if (!sock.Listen (3))
            {
                println ("Listen() error");
            }
            else
            {
                let clientSock = Socket::init;
                let clientAddr = SockAddrIn::init;

                if (!sock.Accept (clientSock, clientAddr))
                {
                    println ("Accept() error");
                }
                else
                {
                    println ("New client ! sock : ", clientSock.handle);

                    let message = clientSock.Recv ();
                    println ("Message : ", message);

                    clientSock.Send ("hello !");
                    clientSock.Close();
                }
            }
        }
        sock.Close();
    }
}
